<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>MATH MASTER | Ultra-Premium P2P</title>
    <!-- Dependencies -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/peerjs@1.5.2/dist/peerjs.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.9.2/dist/confetti.browser.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <link
        href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;600;800&family=Inter:wght@300;400;600;800&family=Space+Grotesk:wght@300;500;700&display=swap"
        rel="stylesheet">
    <style>
        :root {
            --primary: #6366f1;
            --primary-glow: rgba(99, 102, 241, 0.4);
            --secondary: #a855f7;
            --accent: #22d3ee;
            --bg: #030712;
            --card-bg: rgba(255, 255, 255, 0.03);
            --card-border: rgba(255, 255, 255, 0.08);
            --kahoot-red: #ff3355;
            --kahoot-blue: #45a3ff;
            --kahoot-yellow: #ffc233;
            --kahoot-green: #66bf3c;
        }

        body {
            font-family: 'Inter', 'Kanit', sans-serif;
            background: var(--bg);
            color: #f8fafc;
            min-height: 100vh;
            margin: 0;
            overflow-x: hidden;
            touch-action: manipulation;
            letter-spacing: -0.01em;
        }

        .font-brand {
            font-family: 'Space Grotesk', sans-serif;
            letter-spacing: -0.03em;
        }

        /* Dynamic Background */
        .bg-mesh {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            background-color: var(--bg);
            background-image:
                radial-gradient(at 0% 0%, hsla(253, 16%, 7%, 1) 0, transparent 50%),
                radial-gradient(at 50% 0%, hsla(225, 39%, 30%, 0.2) 0, transparent 50%),
                radial-gradient(at 100% 0%, hsla(339, 49%, 30%, 0.2) 0, transparent 50%);
        }

        .math-symbol {
            position: absolute;
            font-size: 1.2rem;
            opacity: 0.15;
            color: var(--primary);
            pointer-events: none;
            filter: blur(1px);
        }

        /* Glassmorphism Evolved */
        .glass-nav {
            background: rgba(3, 7, 18, 0.6);
            backdrop-filter: blur(20px) saturate(180%);
            border-bottom: 1px solid rgba(255, 255, 255, 0.08);
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            z-index: 100;
            height: 72px;
            display: flex;
            align-items: center;
        }

        .cyber-card {
            background: var(--card-bg);
            backdrop-filter: blur(20px);
            border: 1px solid var(--card-border);
            border-radius: 28px;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
            transition: border-color 0.3s ease;
        }

        .cyber-card:hover {
            border-color: rgba(255, 255, 255, 0.15);
        }

        .btn-glow {
            position: relative;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            border-radius: 18px;
            color: white;
            font-weight: 800;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            box-shadow: 0 0 0 rgba(99, 102, 241, 0);
        }

        .btn-glow:hover {
            transform: translateY(-4px) scale(1.02);
            box-shadow: 0 15px 30px var(--primary-glow);
        }

        /* Premium Inputs */
        .cyber-input {
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(255, 255, 255, 0.1);
            color: white;
            border-radius: 18px;
            padding: 1.25rem;
            font-weight: 600;
            transition: all 0.3s ease;
            outline: none;
        }

        .cyber-input:focus {
            background: rgba(255, 255, 255, 0.07);
            border-color: var(--primary);
            box-shadow: 0 0 20px rgba(99, 102, 241, 0.2);
        }

        /* Kahoot Cards 2.0 */
        .kh-btn {
            height: clamp(80px, 12vh, 120px);
            font-weight: 800;
            border-radius: 20px;
            display: flex;
            align-items: center;
            justify-content: flex-start;
            padding: 0 24px;
            gap: 20px;
            font-size: clamp(1.2rem, 4vw, 2.2rem);
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .kh-btn::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(rgba(255, 255, 255, 0.1), transparent);
            pointer-events: none;
        }

        .kh-btn:active:not(:disabled) {
            transform: scale(0.96);
        }

        .kh-red {
            background: linear-gradient(135deg, #ff4b2b, #ff416c);
        }

        .kh-blue {
            background: linear-gradient(135deg, #2193b0, #6dd5ed);
        }

        .kh-yellow {
            background: linear-gradient(135deg, #f7971e, #ffd200);
        }

        .kh-green {
            background: linear-gradient(135deg, #11998e, #38ef7d);
        }

        .hologram-board {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 32px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: inset 0 0 80px rgba(0, 0, 0, 0.6), 0 0 40px rgba(99, 102, 241, 0.1);
            position: relative;
            overflow: hidden;
        }

        .hologram-board::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(90deg, rgba(255, 255, 255, 0.03) 1px, transparent 1px), linear-gradient(rgba(255, 255, 255, 0.03) 1px, transparent 1px);
            background-size: 30px 30px;
            pointer-events: none;
        }

        .circle-stat {
            width: clamp(70px, 18vw, 110px);
            height: clamp(70px, 18vw, 110px);
            border-radius: 50%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            background: rgba(0, 0, 0, 0.5);
            border: 2px solid rgba(255, 255, 255, 0.1);
            font-weight: 900;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
        }

        /* Animations */
        @keyframes float {

            0%,
            100% {
                transform: translateY(0);
            }

            50% {
                transform: translateY(-15px);
            }
        }

        .animate-float {
            animation: float 6s ease-in-out infinite;
        }

        .hero-title {
            background: linear-gradient(to bottom right, #fff 30%, rgba(255, 255, 255, 0.4));
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
            font-weight: 900;
            line-height: 0.9;
        }

        /* Responsive Fixes */
        @media (max-width: 768px) {
            .mobile-hide {
                display: none;
            }

            .kh-btn {
                padding: 0 16px;
                gap: 12px;
            }

            .grid-mobile-1 {
                grid-template-columns: 1fr;
            }

            .playing-container {
                padding-top: 80px;
            }
        }

        ::-webkit-scrollbar {
            width: 6px;
        }

        ::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
        }
    </style>
</head>

<body>
    <div class="bg-mesh" id="mesh-bg"></div>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        const translations = {
            TH: {
                navMusic: "à¹€à¸›à¸´à¸”à¹€à¸žà¸¥à¸‡", title: "MATH MASTER", subtitle: "à¸›à¸£à¸°à¸¥à¸­à¸‡à¸à¸¶à¹‹à¸™à¸„à¸“à¸´à¸•à¸¨à¸²à¸ªà¸•à¸£à¹Œà¸£à¸°à¸šà¸š P2P à¸‚à¸±à¹‰à¸™à¹€à¸—à¸ž",
                start: "à¹€à¸£à¸´à¹ˆà¸¡à¹€à¸à¸¡à¹€à¸¥à¸¢!", language: "à¸ à¸²à¸©à¸² TH", nickname: "à¹ƒà¸ªà¹ˆà¸Šà¸·à¹ˆà¸­à¹€à¸¥à¹ˆà¸™à¸‚à¸­à¸‡à¸„à¸¸à¸“", hostBtn: "à¸ªà¸£à¹‰à¸²à¸‡à¸«à¹‰à¸­à¸‡à¹à¸‚à¹ˆà¸‡",
                joinBtn: "à¹€à¸‚à¹‰à¸²à¸£à¹ˆà¸§à¸¡à¸£à¸š", roomID: "à¸£à¸«à¸±à¸ª PIN", waiting: "à¸£à¸­à¸™à¸±à¸šà¸–à¸­à¸¢à¸«à¸¥à¸±à¸‡...", startHost: "à¸¥à¸¸à¸¢à¹€à¸¥à¸¢!",
                copy: "à¸„à¸±à¸”à¸¥à¸­à¸ PIN", players: "à¸¢à¸­à¸”à¸™à¸±à¸à¸„à¸“à¸´à¸•", question: "à¹‚à¸ˆà¸—à¸¢à¹Œà¸‚à¹‰à¸­à¸—à¸µà¹ˆ", answered: "à¸•à¸­à¸šà¹à¸¥à¹‰à¸§",
                scoreboard: "à¸à¸£à¸°à¸”à¸²à¸™à¹€à¸à¸µà¸¢à¸£à¸•à¸´à¸¢à¸¨", nextSub: "à¹€à¸•à¸£à¸µà¸¢à¸¡à¸•à¸±à¸§à¸‚à¹‰à¸­à¸–à¸±à¸”à¹„à¸›...", champion: "à¹à¸Šà¸¡à¸›à¹Œà¹€à¸›à¸µà¹‰à¸¢à¸™à¸•à¸±à¸§à¸ˆà¸£à¸´à¸‡!",
                back: "à¸à¸¥à¸±à¸šà¸«à¸™à¹‰à¸²à¸«à¸¥à¸±à¸", skip: "à¸‚à¹‰à¸²à¸¡à¹„à¸›à¹€à¸¥à¸¢",
                arithmetic: "à¸¥à¸³à¸”à¸±à¸šà¹€à¸¥à¸‚à¸„à¸“à¸´à¸•", geometric: "à¸¥à¸³à¸”à¸±à¸šà¹€à¸£à¸‚à¸²à¸„à¸“à¸´à¸•"
            },
            EN: {
                navMusic: "Music", title: "MATH MASTER", subtitle: "Ultra-Fast P2P Mathematical Arena",
                start: "START GAME", language: "Language EN", nickname: "Your Nickname", hostBtn: "HOST ROOM",
                joinBtn: "JOIN ROOM", roomID: "PIN CODE", waiting: "Waiting for peers...", startHost: "UNLEASH!",
                copy: "Copy PIN", players: "Warriors", question: "Question", answered: "Answers",
                scoreboard: "HALL OF FAME", nextSub: "Get ready for next...", champion: "THE CHALLENGER!",
                back: "Go Back", skip: "Skip",
                arithmetic: "Arithmetic Sequence", geometric: "Geometric Sequence"
            }
        };

        const generateQuestion = (lang) => {
            const isArithmetic = Math.random() > 0.5;
            const tArray = translations[lang];
            if (isArithmetic) {
                const a1 = Math.floor(Math.random() * 20) + 1;
                const d = Math.floor(Math.random() * 8) + 2;
                const seq = [a1, a1 + d, a1 + d * 2, a1 + d * 3, a1 + d * 4];
                const missingIdx = Math.floor(Math.random() * 5);
                const answer = seq[missingIdx];
                const displaySeq = [...seq]; displaySeq[missingIdx] = '?';
                const options = new Set([answer]);
                while (options.size < 4) {
                    const val = answer + (Math.floor(Math.random() * 10) + 1) * (Math.random() > 0.5 ? 1 : -1);
                    if (val >= 0) options.add(val);
                }
                return { q: displaySeq.join(' , '), options: Array.from(options).sort(() => Math.random() - 0.5), answer, type: tArray.arithmetic, formula: "a_n = a_1 + (n-1)d" };
            } else {
                const a1 = Math.floor(Math.random() * 4) + 1;
                const r = Math.floor(Math.random() * 2) + 2;
                const seq = [a1, a1 * r, a1 * Math.pow(r, 2), a1 * Math.pow(r, 3)];
                const missingIdx = Math.floor(Math.random() * 4);
                const answer = seq[missingIdx];
                const displaySeq = [...seq]; displaySeq[missingIdx] = '?';
                const options = new Set([answer]);
                while (options.size < 4) {
                    const val = answer + (Math.floor(Math.random() * 10) + 1) * (Math.random() > 0.5 ? 1 : -1);
                    if (val > 0) options.add(val);
                }
                return { q: displaySeq.join(' , '), options: Array.from(options).sort(() => Math.random() - 0.5), answer, type: tArray.geometric, formula: "a_n = a_1 * r^(n-1)" };
            }
        };

        function App() {
            const [lang, setLang] = useState(localStorage.getItem('math_lang') || 'TH');
            const [view, setView] = useState('landing');
            const [myPeer, setMyPeer] = useState(null);
            const [pin, setPin] = useState('');
            const [connected, setConnected] = useState(false);
            const [isHost, setIsHost] = useState(false);
            const [username, setUsername] = useState(localStorage.getItem('math_name') || '');
            const [roomCode, setRoomCode] = useState('');
            const [players, setPlayers] = useState([]);
            const [currentQ, setCurrentQ] = useState(null);
            const [timer, setTimer] = useState(30);
            const [hasAnswered, setHasAnswered] = useState(false);
            const [answersCount, setAnswersCount] = useState({ r: 0, t: 0 });
            const [leaderboard, setLeaderboard] = useState([]);
            const [winners, setWinners] = useState([]);

            const connsRef = useRef([]);
            const hostConnRef = useRef(null);
            const gameRef = useRef({ questions: [], idx: 0, players: [], r: 0, tId: null });

            const [netStatus, setNetStatus] = useState('OFFLINE');
            const peerConfig = {
                config: {
                    'iceServers': [
                        { 'urls': 'stun:stun.l.google.com:19302' },
                        { 'urls': 'stun:stun1.l.google.com:19302' },
                        { 'urls': 'stun:stun2.l.google.com:19302' }
                    ]
                },
                debug: 1 // Keep it quiet but log criticals
            };

            const t = translations[lang];

            const cleanupPeer = () => {
                if (myPeer) {
                    myPeer.destroy();
                    setMyPeer(null);
                }
                connsRef.current.forEach(c => c.close());
                connsRef.current = [];
            };

            useEffect(() => {
                const bg = document.getElementById('mesh-bg');
                const symbols = ['+', '-', 'Ã—', 'Ã·', 'âˆš', 'Ï€', 'Î£', 'âˆž', 'Î”', 'âˆ«'];
                for (let i = 0; i < 24; i++) {
                    const el = document.createElement('div'); el.className = 'math-symbol';
                    el.innerText = symbols[Math.floor(Math.random() * symbols.length)];
                    el.style.left = `${Math.random() * 100}%`; el.style.top = `${Math.random() * 100}%`;
                    bg.appendChild(el);
                    gsap.to(el, { y: '+=60', x: '+=40', duration: 15 + Math.random() * 20, repeat: -1, yoyo: true, ease: "sine.inOut" });
                }
                return cleanupPeer;
            }, []);

            const hostBroadcast = (data) => {
                connsRef.current.forEach(c => { if (c.open) c.send(data); });
                updateInternal(data);
            };

            const startHost = () => {
                if (!username) return alert('Nickname needed!');
                cleanupPeer();
                setNetStatus('WAITING...');
                const randomPin = Math.floor(1000 + Math.random() * 9000).toString();
                const p = new Peer(`math-${randomPin}`, peerConfig);

                p.on('open', id => {
                    setPin(id.replace('math-', '')); setMyPeer(p); setConnected(true); setIsHost(true);
                    const initPlayers = [{ id: 'me', name: username, score: 0 }];
                    gameRef.current.players = initPlayers; setPlayers(initPlayers);
                    setNetStatus('ONLINE'); setView('waiting');
                });

                p.on('connection', c => {
                    c.on('data', d => {
                        const g = gameRef.current;
                        if (d.type === 'join') {
                            if (!g.players.find(x => x.id === c.peer)) {
                                g.players.push({ id: c.peer, name: d.name, score: 0 });
                                setPlayers([...g.players]); hostBroadcast({ type: 'plist', p: g.players });
                            }
                        }
                        if (d.type === 'ans') {
                            const pObj = g.players.find(x => x.id === c.peer);
                            if (pObj && !pObj.ans) {
                                pObj.ans = true; if (d.v === g.questions[g.idx - 1].answer) pObj.score++;
                                g.r++; hostBroadcast({ type: 'aupd', r: g.r, t: g.players.length });
                                if (g.r === g.players.length) { clearTimeout(g.tId); showLeaderboard(); }
                            }
                        }
                    });
                    c.on('open', () => {
                        if (!connsRef.current.find(x => x.peer === c.peer)) connsRef.current.push(c);
                        c.send({ type: 'plist', p: gameRef.current.players });
                    });
                    c.on('close', () => {
                        const g = gameRef.current;
                        g.players = g.players.filter(x => x.id !== c.peer);
                        connsRef.current = connsRef.current.filter(x => x.peer !== c.peer);
                        setPlayers([...g.players]); hostBroadcast({ type: 'plist', p: g.players });
                    });
                });
                p.on('error', err => {
                    console.error('Host Peer Error:', err);
                    if (err.type === 'id-taken') startHost();
                    else { setNetStatus('OFFLINE'); alert('Host Error: ' + err.type); }
                });
            };

            const joinRoom = () => {
                if (!username || !roomCode) return alert('Name & PIN needed!');
                cleanupPeer();
                setNetStatus('JOINING...');
                const p = new Peer(peerConfig); setMyPeer(p);
                p.on('open', (id) => {
                    const c = p.connect(`math-${roomCode}`, { reliable: true }); hostConnRef.current = c;
                    c.on('open', () => {
                        c.send({ type: 'join', name: username });
                        setView('waiting'); setConnected(true); setNetStatus('CONNECTED');
                    });
                    c.on('data', d => updateInternal(d));
                    c.on('error', (err) => {
                        alert('Connect Error: ' + err.type);
                        setNetStatus('FAILED'); setView('home');
                    });
                    c.on('close', () => { alert('Host disconnected!'); window.location.reload(); });
                });
                p.on('error', e => {
                    console.error('Join Peer Error:', e);
                    setNetStatus('FAILED');
                    if (e.type === 'peer-unavailable') alert('Room not found! Check PIN.');
                    else alert('Error: ' + e.type);
                });
            };

            const updateInternal = d => {
                if (d.type === 'plist') setPlayers(d.p);
                if (d.type === 'nextq') { setCurrentQ(d); setView('playing'); setHasAnswered(false); setTimer(30); setAnswersCount({ r: 0, t: d.total_players }); }
                if (d.type === 'aupd') setAnswersCount({ r: d.r, t: d.t });
                if (d.type === 'lbd') { setLeaderboard([...d.p]); setView('leaderboard'); }
                if (d.type === 'gov') { setWinners(d.rank); setView('gameover'); confetti({ particleCount: 150 }); }
            };

            useEffect(() => {
                gsap.fromTo(".view-container", { opacity: 0, y: 20 }, { opacity: 1, y: 0, duration: 0.6, ease: "power2.out" });
            }, [view]);

            const startGame = () => {
                const g = gameRef.current; g.questions = Array.from({ length: 10 }, () => generateQuestion(lang));
                g.idx = 0; nextQ();
            };

            const nextQ = () => {
                const g = gameRef.current;
                if (g.idx < 10) {
                    g.r = 0; g.players.forEach(p => p.ans = false);
                    const qData = g.questions[g.idx];
                    hostBroadcast({ type: 'nextq', q: qData.q, opts: qData.options, n: g.idx + 1, total_players: g.players.length, formula: qData.formula, qType: qData.type });
                    g.idx++; g.tId = setTimeout(showLeaderboard, 30500);
                } else hostBroadcast({ type: 'gov', rank: [...g.players].sort((a, b) => b.score - a.score).slice(0, 5) });
            };

            const showLeaderboard = () => { hostBroadcast({ type: 'lbd', p: [...gameRef.current.players].sort((a, b) => b.score - a.score) }); setTimeout(nextQ, 5000); };

            const submit = v => {
                setHasAnswered(true);
                if (isHost) {
                    const g = gameRef.current; const p = g.players.find(x => x.id === 'me'); p.ans = true;
                    if (v === g.questions[g.idx - 1].answer) p.score++;
                    g.r++; hostBroadcast({ type: 'aupd', r: g.r, t: g.players.length });
                    if (g.r === g.players.length) { clearTimeout(g.tId); showLeaderboard(); }
                } else {
                    if (hostConnRef.current && hostConnRef.current.open) {
                        hostConnRef.current.send({ type: 'ans', v });
                    } else {
                        alert('Not connected to Host!');
                        setNetStatus('FAILED');
                    }
                }
            };

            useEffect(() => { localStorage.setItem('math_name', username); }, [username]);

            const Shape = ({ type }) => {
                if (type === 'tri') return <svg className="w-8 h-8 md:w-10 md:h-10 fill-white" viewBox="0 0 24 24"><path d="M12 2L2 22h20L12 2z" /></svg>;
                if (type === 'dia') return <svg className="w-8 h-8 md:w-10 md:h-10 fill-white" viewBox="0 0 24 24"><path d="M12 2l10 10-10 10-10-10z" /></svg>;
                if (type === 'cir') return <svg className="w-8 h-8 md:w-10 md:h-10 fill-white" viewBox="0 0 24 24"><circle cx="12" cy="12" r="10" /></svg>;
                if (type === 'squ') return <svg className="w-8 h-8 md:w-10 md:h-10 fill-white" viewBox="0 0 24 24"><rect x="2" y="2" width="20" height="20" /></svg>;
                return null;
            };

            return (
                <div className="min-h-screen flex flex-col">
                    <nav className="glass-nav px-6">
                        <div className="max-w-7xl mx-auto w-full flex justify-between items-center">
                            <div className="flex items-center gap-3 cursor-pointer" onClick={() => setView('landing')}>
                                <div className="w-9 h-9 bg-indigo-600 rounded-lg flex items-center justify-center font-black">M</div>
                                <span className="text-xl font-brand font-bold tracking-tight navbar-text">MATH<span className="text-indigo-400">MASTER</span></span>
                            </div>
                            <div className="flex gap-4 items-center">
                                <div className={`px-3 py-1 rounded-full text-[9px] font-black tracking-widest border ${netStatus === 'ONLINE' || netStatus === 'CONNECTED' ? 'bg-green-500/10 border-green-500/30 text-green-400' : 'bg-amber-500/10 border-amber-500/30 text-amber-400'}`}>
                                    {netStatus}
                                </div>
                                <a href="https://www.youtube.com/watch?v=Nbc7scngySc&list=RDNbc7scngySc&start_radio=1" target="_blank" className="text-sm font-bold text-rose-400 hover:text-rose-300 transition-colors uppercase tracking-widest flex items-center gap-2">ðŸŽµ <span className="hidden sm:inline">{t.navMusic}</span></a>
                                <button onClick={() => setLang(l => l === 'TH' ? 'EN' : 'TH')} className="bg-white/5 border border-white/10 px-4 py-1.5 rounded-full text-[10px] font-black uppercase tracking-widest">{t.language}</button>
                            </div>
                        </div>
                    </nav>

                    <div className="flex-1 flex flex-col">
                        {view === 'landing' && (
                            <div className="flex-1 flex flex-col items-center justify-center p-6 text-center">
                                <div className="animate-float mb-8">
                                    <div className="w-24 h-24 bg-indigo-600 rounded-3xl flex items-center justify-center font-black text-6xl shadow-2xl shadow-indigo-500/40 rotate-12">M</div>
                                </div>
                                <h1 className="hero-title font-brand italic tracking-tighter uppercase mb-6 text-[clamp(3.5rem,12vw,8rem)]">
                                    CHALLENGE<br />YOUR <span className="text-indigo-400">MIND.</span>
                                </h1>
                                <p className="text-lg md:text-xl opacity-40 max-w-xl mb-12 font-medium tracking-wide uppercase">{t.subtitle}</p>
                                <div className="flex flex-col sm:flex-row gap-4 w-full max-w-sm">
                                    <button onClick={() => setView('home')} className="flex-1 btn-glow py-6 rounded-2xl text-xl shadow-2xl">{t.start}</button>
                                </div>
                            </div>
                        )}

                        {view === 'home' && (
                            <div className="flex-1 flex items-center justify-center p-6">
                                <div className="cyber-card p-12 max-w-md w-full text-center">
                                    <h2 className="text-3xl font-brand font-black mb-10 italic text-indigo-400 tracking-tighter">SETUP ARENA</h2>
                                    <input className="w-full cyber-input mb-4 text-lg" placeholder={t.nickname} value={username} onChange={e => setUsername(e.target.value)} />
                                    <button onClick={startHost} className="w-full btn-glow py-5 rounded-2xl text-lg mb-8 shadow-xl">{t.hostBtn}</button>
                                    <div className="mb-8 opacity-20 font-black text-[10px] tracking-[0.8em] uppercase">--- OR ---</div>
                                    <input className="w-full cyber-input mb-4 text-center text-3xl font-black tracking-[0.4em]" placeholder="PIN" value={roomCode} maxLength={4} onChange={e => setRoomCode(e.target.value.replace(/[^0-9]/g, ''))} />
                                    <button onClick={joinRoom} disabled={roomCode.length < 4} className="w-full border border-white/5 bg-white/[0.02] py-5 rounded-2xl font-black hover:bg-white/5 disabled:opacity-20 transition-all tracking-widest text-xs">JOIN ARENA</button>
                                </div>
                            </div>
                        )}

                        {view === 'waiting' && (
                            <div className="flex-1 flex flex-col items-center justify-center p-6">
                                <div className="max-w-6xl w-full grid grid-mobile-1 md:grid-cols-2 gap-12">
                                    <div className="cyber-card p-12 text-center border-t-8 border-indigo-500 flex flex-col items-center justify-center">
                                        <div className="text-[10px] font-black opacity-30 mb-4 tracking-[0.5em] uppercase">ROOM PIN</div>
                                        <div className="text-8xl md:text-[10rem] font-brand font-black tracking-tighter mb-10 text-white selection:bg-indigo-500 leading-none">{pin || roomCode}</div>
                                        {isHost && <button onClick={startGame} className="w-full btn-glow py-6 rounded-3xl text-2xl font-black uppercase tracking-[0.2em]">{t.startHost}</button>}
                                        {!isHost && <div className="text-indigo-400 font-bold animate-pulse mt-4 tracking-widest uppercase">{t.waiting}</div>}
                                    </div>
                                    <div className="flex flex-col">
                                        <h3 className="text-3xl font-brand font-black italic mb-8 uppercase tracking-tighter flex items-center gap-4">
                                            <div className="w-3 h-3 bg-indigo-500 rounded-full animate-ping"></div>
                                            {t.players} Â· <span className="text-indigo-400">{players.length}</span>
                                        </h3>
                                        <div className="grid grid-cols-1 sm:grid-cols-2 gap-4 overflow-y-auto max-h-[50vh] pr-2 custom-scroll">
                                            {players.map((p, i) => (
                                                <div key={i} className="p-5 cyber-card flex items-center gap-4 bg-white/[0.04]">
                                                    <div className="w-10 h-10 rounded-xl bg-gradient-to-br from-indigo-500 to-purple-600 flex items-center justify-center font-black text-white shadow-lg">{p.name[0]}</div>
                                                    <span className="font-bold tracking-tight text-lg truncate uppercase">{p.name} {p.id === 'me' && 'ðŸ‘‘'}</span>
                                                </div>
                                            ))}
                                        </div>
                                    </div>
                                </div>
                            </div>
                        )}

                        {view === 'playing' && (
                            <div className="flex-1 flex flex-col p-6 max-w-7xl mx-auto w-full playing-container view-container mt-[70px]">
                                <div className="flex justify-between items-center mb-10">
                                    <div className="flex flex-col">
                                        <h3 className="text-[10px] font-black opacity-30 tracking-[0.6em] uppercase mb-1">{t.question}</h3>
                                        <div className="text-4xl md:text-5xl font-brand font-black italic tracking-tighter uppercase">{currentQ.n} <span className="text-indigo-500 opacity-40">/ 10</span></div>
                                    </div>
                                    <div className="flex gap-4">
                                        {isHost && <button onClick={showLeaderboard} className="bg-white/5 border border-white/10 px-6 py-2 rounded-xl text-[10px] font-black hover:bg-white/10 transition-all uppercase tracking-widest">{t.skip}</button>}
                                        <div className="bg-indigo-500/10 border border-indigo-500/30 px-5 py-2 rounded-xl text-[10px] font-black text-indigo-400 tracking-[0.2em] mobile-hide uppercase">NETWORK: STABLE</div>
                                    </div>
                                </div>

                                <div className="flex-1 grid grid-cols-1 lg:grid-cols-12 gap-8 items-center mb-10">
                                    <div className="lg:col-span-2 flex flex-col items-center justify-center order-2 lg:order-1">
                                        <div className="circle-stat border-indigo-500 text-4xl md:text-5xl mb-3">
                                            <span className={timer < 6 ? 'text-rose-500 animate-pulse' : 'text-white'}>{timer}</span>
                                        </div>
                                        <div className="text-[9px] font-black opacity-30 tracking-[0.3em] uppercase">Time left</div>
                                    </div>

                                    <div className="lg:col-span-8 hologram-board min-h-[35vh] flex flex-col items-center justify-center text-center p-12 order-1 lg:order-2">
                                        <div className="text-[10px] font-black text-indigo-400 mb-6 tracking-[0.5em] uppercase">{currentQ.qType}</div>
                                        <div className="bg-white text-black px-12 py-8 md:py-14 rounded-[40px] font-brand font-black text-4xl md:text-7xl shadow-[0_30px_60px_rgba(0,0,0,0.5)] mb-10 select-none transform hover:scale-105 transition-transform duration-500">
                                            {currentQ.q}
                                        </div>
                                        <div className="bg-white/[0.05] border border-white/[0.08] px-8 py-3 rounded-full font-mono text-indigo-300 text-sm md:text-base tracking-widest uppercase">
                                            {currentQ.formula}
                                        </div>
                                    </div>

                                    <div className="lg:col-span-2 flex flex-col items-center justify-center order-3">
                                        <div className="circle-stat border-emerald-500 text-4xl md:text-5xl mb-3">{answersCount.r}</div>
                                        <div className="text-[9px] font-black opacity-30 tracking-[0.3em] uppercase">{t.answered}</div>
                                    </div>
                                </div>

                                <div className="grid grid-cols-1 sm:grid-cols-2 gap-5 sm:h-[30vh]">
                                    {['kh-red', 'kh-blue', 'kh-yellow', 'kh-green'].map((c, i) => (
                                        <button key={i} onClick={() => submit(currentQ.opts[i])} disabled={hasAnswered} className={`kh-btn ${c} ${hasAnswered ? 'opacity-20 scale-95 pointer-events-none' : 'hover:-translate-y-1 shadow-2xl'}`}>
                                            <Shape type={['tri', 'dia', 'cir', 'squ'][i]} />
                                            <span className="truncate">{currentQ.opts[i]}</span>
                                        </button>
                                    ))}
                                </div>
                            </div>
                        )}

                        {view === 'leaderboard' && (
                            <div className="flex-1 flex flex-col items-center justify-center p-6 view-container">
                                <h2 className="text-5xl md:text-8xl font-brand font-black italic mb-16 uppercase tracking-tighter text-indigo-400 hero-title">{t.scoreboard}</h2>
                                <div className="max-w-xl w-full space-y-4">
                                    {players.sort((a, b) => b.score - a.score).map((p, i) => (
                                        <div key={i} className={`p-8 cyber-card flex justify-between items-center ${i === 0 ? 'bg-indigo-500/10 border-indigo-500 shadow-2xl shadow-indigo-500/20' : 'bg-white/[0.02]'}`}>
                                            <div className="flex items-center gap-8">
                                                <span className={`text-4xl font-brand font-black ${i === 0 ? 'text-indigo-400' : 'opacity-10'}`}>#{i + 1}</span>
                                                <span className="text-xl md:text-2xl font-black uppercase tracking-tight truncate max-w-[150px] sm:max-w-none">{p.name} {p.id === 'me' && 'ðŸ‘‘'}</span>
                                            </div>
                                            <div className="flex flex-col items-end">
                                                <div className="text-3xl md:text-4xl font-brand font-black text-white">{p.score}</div>
                                                <div className="text-[8px] font-black opacity-30 tracking-[0.2em] uppercase">Total Points</div>
                                            </div>
                                        </div>
                                    ))}
                                    <div className="text-center pt-10 text-indigo-400 font-black animate-pulse tracking-[0.5em] uppercase text-xs">{t.nextSub}</div>
                                </div>
                            </div>
                        )}

                        {view === 'gameover' && (
                            <div className="flex-1 flex flex-col items-center justify-center p-6 text-center view-container">
                                <h2 className="hero-title text-6xl md:text-9xl font-brand font-black italic uppercase tracking-tighter mb-20">{t.champion}</h2>
                                <div className="flex justify-center items-end gap-3 md:gap-8 mb-24 px-4 w-full max-w-3xl">
                                    {winners[1] && (
                                        <div className="flex-1 cyber-card p-10 rounded-t-[40px] border-t-8 border-slate-400 flex flex-col items-center max-w-[180px] bg-slate-400/5 h-[35vh] justify-center">
                                            <div className="text-5xl mb-6 grayscale">ðŸ¥ˆ</div>
                                            <div className="font-black truncate w-full uppercase text-sm tracking-tight">{winners[1].name}</div>
                                        </div>
                                    )}
                                    {winners[0] && (
                                        <div className="flex-1 cyber-card p-14 rounded-t-[40px] border-t-[12px] border-indigo-500 relative -top-12 shadow-[0_40px_100px_rgba(99,102,241,0.3)] flex flex-col items-center max-w-[240px] bg-indigo-500/10 h-[45vh] justify-center">
                                            <div className="text-8xl mb-8 animate-float">ðŸ¥‡</div>
                                            <div className="text-2xl font-black truncate w-full uppercase tracking-tighter text-indigo-400">{winners[0].name}</div>
                                            <div className="text-[10px] font-black opacity-30 mt-2 uppercase tracking-widest">Grand Champion</div>
                                        </div>
                                    )}
                                    {winners[2] && (
                                        <div className="flex-1 cyber-card p-10 rounded-t-[40px] border-t-8 border-amber-700 flex flex-col items-center max-w-[180px] bg-amber-700/5 h-[30vh] justify-center">
                                            <div className="text-5xl mb-6 brightness-50">ðŸ¥‰</div>
                                            <div className="font-black truncate w-full uppercase text-sm tracking-tight">{winners[2].name}</div>
                                        </div>
                                    )}
                                </div>
                                <button onClick={() => window.location.reload()} className="btn-glow px-16 py-6 rounded-[24px] text-2xl shadow-2xl tracking-[0.2em]">{t.back}</button>
                            </div>
                        )}
                    </div>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>

</html>