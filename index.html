<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>MATH MASTER | Ultra-Premium P2P</title>
    <!-- Dependencies -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/peerjs@1.5.2/dist/peerjs.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.9.2/dist/confetti.browser.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <link
        href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;600;800&family=Inter:wght@400;600;800&display=swap"
        rel="stylesheet">
    <style>
        :root {
            --kahoot-purple: #46178f;
            --kahoot-dark: #330e6b;
            --kahoot-red: #e21b3c;
            --kahoot-blue: #1368ce;
            --kahoot-yellow: #d89e00;
            --kahoot-green: #26890c;
            --white: #ffffff;
            --gray: #f2f2f2;
        }

        body {
            font-family: 'Kanit', 'Inter', sans-serif;
            background: var(--kahoot-purple);
            color: var(--white);
            min-height: 100vh;
            margin: 0;
            overflow-x: hidden;
            display: flex;
            flex-direction: column;
        }

        /* Clean Navbar */
        .kahoot-nav {
            background: var(--white);
            color: var(--kahoot-purple);
            height: 64px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 24px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            position: fixed;
            top: 0;
            width: 100%;
            z-index: 1000;
        }

        .nav-link {
            font-weight: 800;
            text-transform: uppercase;
            font-size: 14px;
            padding: 8px 16px;
            border-radius: 4px;
            transition: 0.2s;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .nav-link:hover {
            background: rgba(70, 23, 143, 0.05);
        }

        .nav-link.active {
            color: var(--kahoot-red);
        }

        /* Main Container */
        .main-content {
            margin-top: 64px;
            flex: 1;
            display: flex;
            flex-direction: column;
        }

        /* Clean Cards */
        .kahoot-card {
            background: var(--white);
            color: #333;
            border-radius: 4px;
            padding: 32px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            max-width: 480px;
            width: 100%;
            text-align: center;
        }

        .kahoot-input {
            width: 100%;
            padding: 16px;
            border: 2px solid #ccc;
            border-radius: 4px;
            font-size: 18px;
            font-weight: 800;
            text-align: center;
            outline: none;
            transition: 0.2s;
        }

        .kahoot-input:focus {
            border-color: var(--kahoot-purple);
        }

        .btn-enter {
            background: #333;
            color: var(--white);
            font-weight: 800;
            padding: 16px;
            width: 100%;
            border-radius: 4px;
            font-size: 18px;
            margin-top: 16px;
            transition: 0.2s;
        }

        .btn-enter:hover {
            background: #000;
        }

        /* Kahoot Grid Buttons */
        .grid-button {
            height: clamp(80px, 15vh, 180px);
            font-size: clamp(1.5rem, 4vw, 3rem);
            font-weight: 800;
            color: var(--white);
            display: flex;
            align-items: center;
            padding: 0 24px;
            gap: 16px;
            border-radius: 4px;
            box-shadow: 0 4px 0 rgba(0, 0, 0, 0.2);
            transition: 0.1s;
        }

        .grid-button:active {
            transform: translateY(2px);
            box-shadow: 0 2px 0 rgba(0, 0, 0, 0.2);
        }

        .kb-red {
            background: var(--kahoot-red);
        }

        .kb-blue {
            background: var(--kahoot-blue);
        }

        .kb-yellow {
            background: var(--kahoot-yellow);
        }

        .kb-green {
            background: var(--kahoot-green);
        }

        .chalkboard {
            background: var(--white);
            color: #333;
            padding: 24px;
            text-align: center;
            border-radius: 4px;
            font-size: clamp(2rem, 8vw, 6rem);
            font-weight: 800;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
        }

        /* Status Badge */
        .status-badge {
            background: var(--kahoot-purple);
            color: var(--white);
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 800;
        }

        /* About Page Names */
        .about-name {
            font-size: 24px;
            font-weight: 700;
            color: var(--kahoot-purple);
            margin-bottom: 12px;
            border-bottom: 1px solid #eee;
            padding-bottom: 8px;
            text-align: left;
        }

        @media (max-width: 768px) {
            .nav-text {
                display: none;
            }

            .kahoot-card {
                margin: 20px;
            }
        }
    </style>
</head>

<body>
    <div class="bg-mesh" id="mesh-bg"></div>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        const translations = {
            TH: {
                title: "‡∏ä‡∏∏‡∏î‡∏ù‡∏∂‡∏Å‡∏ó‡∏±‡∏Å‡∏©‡∏∞‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå",
                subtitle: "‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏•‡∏£‡∏∞‡∏ö‡∏ö‡∏õ‡∏£‡∏∞‡∏™‡∏≤‡∏ó",
                start: "‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô",
                nickname: "‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏•‡πà‡∏ô‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì",
                hostBtn: "‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏´‡πâ‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà (HOST)",
                joinBtn: "‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏° (JOIN)",
                players: "‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î",
                waiting: "‡∏£‡∏≠‡πÄ‡∏ã‡∏¥‡∏£‡πå‡∏ü‡πÄ‡∏ß‡∏≠‡∏£‡πå‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏Å‡∏°...",
                startHost: "‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏•‡πà‡∏ô‡∏ó‡∏±‡∏ô‡∏ó‡∏µ!",
                question: "‡∏Ç‡πâ‡∏≠‡∏ó‡∏µ‡πà",
                answered: "‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö‡πÅ‡∏•‡πâ‡∏ß",
                skip: "‡∏Ç‡πâ‡∏≤‡∏°‡πÑ‡∏õ‡∏î‡∏π‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô",
                scoreboard: "‡∏≠‡∏±‡∏ô‡∏î‡∏±‡∏ö‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô",
                nextSub: "‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏û‡∏ö‡∏Å‡∏±‡∏ö‡πÇ‡∏à‡∏ó‡∏¢‡πå‡∏ñ‡∏±‡∏î‡πÑ‡∏õ...",
                champion: "‡∏ú‡∏π‡πâ‡∏ä‡∏ô‡∏∞‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î",
                back: "‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å",
                navHome: "‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å",
                navAbout: "‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Å‡∏±‡∏ö‡πÄ‡∏£‡∏≤",
                language: "‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏†‡∏≤‡∏©‡∏≤",
                developedBy: "‡∏ú‡∏π‡πâ‡∏û‡∏±‡∏í‡∏ô‡∏≤‡∏£‡∏∞‡∏ö‡∏ö"
            },
            EN: {
                title: "MATH MASTER ULTRA",
                subtitle: "Prepare for neural link processing",
                start: "START MISSION",
                nickname: "Enter your codename",
                hostBtn: "INITIALIZE HOST",
                joinBtn: "JOIN ARENA",
                players: "ACTIVE USERS",
                waiting: "WAITING FOR UPLINK...",
                startHost: "EXECUTE START",
                question: "SEQUENCE",
                answered: "ANSWERS_SYNCED",
                skip: "FORCE_SKIP",
                scoreboard: "RANKING_DATA",
                nextSub: "PREPARING NEXT NODE...",
                champion: "PRIME CHAMPION",
                back: "REBOOT_SESSION",
                navHome: "HOME",
                navAbout: "ABOUT US",
                language: "CHANGE LANG",
                developedBy: "DEVELOPED BY"
            }
        };

        const generateQuestion = (lang) => {
            const isArithmetic = Math.random() > 0.5;
            const tArray = translations[lang];
            if (isArithmetic) {
                const a1 = Math.floor(Math.random() * 20) + 1;
                const d = Math.floor(Math.random() * 8) + 2;
                const seq = [a1, a1 + d, a1 + d * 2, a1 + d * 3, a1 + d * 4];
                const missingIdx = Math.floor(Math.random() * 5);
                const answer = seq[missingIdx];
                const displaySeq = [...seq]; displaySeq[missingIdx] = '?';
                const options = new Set([answer]);
                while (options.size < 4) {
                    const val = answer + (Math.floor(Math.random() * 10) + 1) * (Math.random() > 0.5 ? 1 : -1);
                    if (val >= 0) options.add(val);
                }
                return { q: displaySeq.join(' , '), options: Array.from(options).sort(() => Math.random() - 0.5), answer, type: tArray.arithmetic, formula: "a_n = a_1 + (n-1)d" };
            } else {
                const a1 = Math.floor(Math.random() * 4) + 1;
                const r = Math.floor(Math.random() * 2) + 2;
                const seq = [a1, a1 * r, a1 * Math.pow(r, 2), a1 * Math.pow(r, 3)];
                const missingIdx = Math.floor(Math.random() * 4);
                const answer = seq[missingIdx];
                const displaySeq = [...seq]; displaySeq[missingIdx] = '?';
                const options = new Set([answer]);
                while (options.size < 4) {
                    const val = answer + (Math.floor(Math.random() * 10) + 1) * (Math.random() > 0.5 ? 1 : -1);
                    if (val > 0) options.add(val);
                }
                return { q: displaySeq.join(' , '), options: Array.from(options).sort(() => Math.random() - 0.5), answer, type: tArray.geometric, formula: "a_n = a_1 * r^(n-1)" };
            }
        };

        function App() {
            const [lang, setLang] = useState(localStorage.getItem('math_lang') || 'TH');
            const [view, setView] = useState('landing');
            const [myPeer, setMyPeer] = useState(null);
            const [pin, setPin] = useState('');
            const [connected, setConnected] = useState(false);
            const [isHost, setIsHost] = useState(false);
            const [username, setUsername] = useState(localStorage.getItem('math_name') || '');
            const [roomCode, setRoomCode] = useState('');
            const [players, setPlayers] = useState([]);
            const [currentQ, setCurrentQ] = useState(null);
            const [timer, setTimer] = useState(30);
            const [hasAnswered, setHasAnswered] = useState(false);
            const [answersCount, setAnswersCount] = useState({ r: 0, t: 0 });
            const [leaderboard, setLeaderboard] = useState([]);
            const [winners, setWinners] = useState([]);

            const connsRef = useRef([]);
            const hostConnRef = useRef(null);
            const gameRef = useRef({ questions: [], idx: 0, players: [], r: 0, tId: null });

            const [netStatus, setNetStatus] = useState('OFFLINE');
            const peerConfig = {
                host: '0.peerjs.com',
                port: 443,
                secure: true,
                config: {
                    'iceServers': [
                        { 'urls': 'stun:stun.l.google.com:19302' },
                        { 'urls': 'stun:stun1.l.google.com:19302' },
                        { 'urls': 'stun:stun2.l.google.com:19302' }
                    ]
                },
                debug: 1 // Keep it quiet but log criticals
            };

            const t = translations[lang];

            const cleanupPeer = () => {
                if (myPeer) {
                    myPeer.destroy();
                    setMyPeer(null);
                }
                connsRef.current.forEach(c => c.close());
                connsRef.current = [];
            };

            useEffect(() => {
                return cleanupPeer;
            }, []);

            const hostBroadcast = (data) => {
                connsRef.current.forEach(c => { if (c.open) c.send(data); });
                updateInternal(data);
            };

            const startHost = () => {
                if (!username) return alert('Nickname needed!');
                cleanupPeer();
                setNetStatus('WAITING...');
                const randomPin = Math.floor(1000 + Math.random() * 9000).toString();
                const p = new Peer(`math-${randomPin}`, peerConfig);

                p.on('open', id => {
                    setPin(id.replace('math-', '')); setMyPeer(p); setConnected(true); setIsHost(true);
                    const initPlayers = [{ id: 'me', name: username, score: 0 }];
                    gameRef.current.players = initPlayers; setPlayers(initPlayers);
                    setNetStatus('ONLINE'); setView('waiting');
                });

                p.on('connection', c => {
                    c.on('data', d => {
                        const g = gameRef.current;
                        if (d.type === 'join') {
                            if (!g.players.find(x => x.id === c.peer)) {
                                g.players.push({ id: c.peer, name: d.name, score: 0 });
                                setPlayers([...g.players]); hostBroadcast({ type: 'plist', p: g.players });
                            }
                        }
                        if (d.type === 'ans') {
                            const pObj = g.players.find(x => x.id === c.peer);
                            if (pObj && !pObj.ans) {
                                pObj.ans = true; if (d.v === g.questions[g.idx - 1].answer) pObj.score++;
                                g.r++; hostBroadcast({ type: 'aupd', r: g.r, t: g.players.length });
                                if (g.r === g.players.length) { clearTimeout(g.tId); showLeaderboard(); }
                            }
                        }
                    });
                    c.on('open', () => {
                        if (!connsRef.current.find(x => x.peer === c.peer)) connsRef.current.push(c);
                        c.send({ type: 'plist', p: gameRef.current.players });
                    });
                    c.on('close', () => {
                        const g = gameRef.current;
                        g.players = g.players.filter(x => x.id !== c.peer);
                        connsRef.current = connsRef.current.filter(x => x.peer !== c.peer);
                        setPlayers([...g.players]); hostBroadcast({ type: 'plist', p: g.players });
                    });
                });
                p.on('error', err => {
                    console.error('Host Peer Error:', err);
                    if (err.type === 'id-taken') startHost();
                    else { setNetStatus('OFFLINE'); alert('Host Error: ' + err.type); }
                });
            };

            const joinRoom = () => {
                if (!username || !roomCode) return alert('Name & PIN needed!');
                cleanupPeer();
                setNetStatus('JOINING...');
                const p = new Peer(peerConfig); setMyPeer(p);
                p.on('open', (id) => {
                    const c = p.connect(`math-${roomCode}`, { reliable: true }); hostConnRef.current = c;
                    c.on('open', () => {
                        c.send({ type: 'join', name: username });
                        setView('waiting'); setConnected(true); setNetStatus('CONNECTED');
                    });
                    c.on('data', d => updateInternal(d));
                    c.on('error', (err) => {
                        alert('Connect Error: ' + err.type);
                        setNetStatus('FAILED'); setView('home');
                    });
                    c.on('close', () => { alert('Host disconnected!'); window.location.reload(); });
                });
                p.on('error', e => {
                    console.error('Join Peer Error:', e);
                    setNetStatus('FAILED');
                    if (e.type === 'peer-unavailable') alert('Room not found! Check PIN.');
                    else alert('Error: ' + e.type);
                });
            };

            const updateInternal = d => {
                if (d.type === 'plist') setPlayers(d.p);
                if (d.type === 'nextq') { setCurrentQ(d); setView('playing'); setHasAnswered(false); setTimer(30); setAnswersCount({ r: 0, t: d.total_players }); }
                if (d.type === 'aupd') setAnswersCount({ r: d.r, t: d.t });
                if (d.type === 'lbd') { setLeaderboard([...d.p]); setView('leaderboard'); }
                if (d.type === 'gov') { setWinners(d.rank); setView('gameover'); confetti({ particleCount: 150 }); }
            };

            useEffect(() => {
                gsap.fromTo(".view-container", { opacity: 0, y: 20 }, { opacity: 1, y: 0, duration: 0.6, ease: "power2.out" });
            }, [view]);

            const startGame = () => {
                const g = gameRef.current; g.questions = Array.from({ length: 10 }, () => generateQuestion(lang));
                g.idx = 0; nextQ();
            };

            const nextQ = () => {
                const g = gameRef.current;
                if (g.idx < 10) {
                    g.r = 0; g.players.forEach(p => p.ans = false);
                    const qData = g.questions[g.idx];
                    hostBroadcast({ type: 'nextq', q: qData.q, opts: qData.options, n: g.idx + 1, total_players: g.players.length, formula: qData.formula, qType: qData.type });
                    g.idx++; g.tId = setTimeout(showLeaderboard, 30500);
                } else hostBroadcast({ type: 'gov', rank: [...g.players].sort((a, b) => b.score - a.score).slice(0, 5) });
            };

            const showLeaderboard = () => { hostBroadcast({ type: 'lbd', p: [...gameRef.current.players].sort((a, b) => b.score - a.score) }); setTimeout(nextQ, 5000); };

            const submit = v => {
                setHasAnswered(true);
                if (isHost) {
                    const g = gameRef.current; const p = g.players.find(x => x.id === 'me'); p.ans = true;
                    if (v === g.questions[g.idx - 1].answer) p.score++;
                    g.r++; hostBroadcast({ type: 'aupd', r: g.r, t: g.players.length });
                    if (g.r === g.players.length) { clearTimeout(g.tId); showLeaderboard(); }
                } else {
                    if (hostConnRef.current && hostConnRef.current.open) {
                        hostConnRef.current.send({ type: 'ans', v });
                    } else {
                        alert('Not connected to Host!');
                        setNetStatus('FAILED');
                    }
                }
            };

            useEffect(() => { localStorage.setItem('math_name', username); }, [username]);

            const Shape = ({ type }) => {
                if (type === 'tri') return <svg className="w-8 h-8 md:w-10 md:h-10 fill-white" viewBox="0 0 24 24"><path d="M12 2L2 22h20L12 2z" /></svg>;
                if (type === 'dia') return <svg className="w-8 h-8 md:w-10 md:h-10 fill-white" viewBox="0 0 24 24"><path d="M12 2l10 10-10 10-10-10z" /></svg>;
                if (type === 'cir') return <svg className="w-8 h-8 md:w-10 md:h-10 fill-white" viewBox="0 0 24 24"><circle cx="12" cy="12" r="10" /></svg>;
                if (type === 'squ') return <svg className="w-8 h-8 md:w-10 md:h-10 fill-white" viewBox="0 0 24 24"><rect x="2" y="2" width="20" height="20" /></svg>;
                return null;
            };

            return (
                <div className="min-h-screen flex flex-col">
                    <nav className="kahoot-nav">
                        <div className="flex items-center gap-6">
                            <div className="flex items-center gap-2 cursor-pointer" onClick={() => setView('landing')}>
                                <div className="w-10 h-10 bg-[#46178f] text-white flex items-center justify-center font-black text-2xl rounded-sm">K!</div>
                                <span className="text-xl font-black text-[#46178f] hidden sm:inline">Math Master</span>
                            </div>
                            <div className="flex gap-2">
                                <div className={`nav-link ${view === 'landing' || view === 'home' ? 'active' : ''}`} onClick={() => setView('landing')}>
                                    <span className="nav-text">{t.navHome}</span>
                                </div>
                                <div className={`nav-link ${view === 'about' ? 'active' : ''}`} onClick={() => setView('about')}>
                                    <span className="nav-text">{t.navAbout}</span>
                                </div>
                            </div>
                        </div>
                        <div className="flex items-center gap-4">
                            <div className="status-badge mobile-hide">
                                {netStatus}
                            </div>
                            <button onClick={() => setLang(l => l === 'TH' ? 'EN' : 'TH')} className="nav-link font-black">
                                üåé <span className="nav-text">{t.language}</span>
                            </button>
                        </div>
                    </nav>

                    <div className="main-content">
                        {view === 'landing' && (
                            <div className="flex-1 flex flex-col items-center justify-center p-6 text-center">
                                <div className="mb-8">
                                    <div className="text-8xl font-black text-white selection:bg-white selection:text-[#46178f]">Kahoot!</div>
                                </div>
                                <div className="kahoot-card">
                                    <h1 className="text-2xl font-black mb-6 uppercase text-[#333]">{t.title}</h1>
                                    <p className="text-[#666] mb-8 font-bold">{t.subtitle}</p>
                                    <button onClick={() => setView('home')} className="btn-enter">{t.start}</button>
                                </div>
                            </div>
                        )}

                        {view === 'about' && (
                            <div className="flex-1 flex items-center justify-center p-6">
                                <div className="kahoot-card max-w-2xl">
                                    <h2 className="text-3xl font-black mb-10 text-[#46178f] uppercase border-b-4 border-[#46178f] pb-4">{t.navAbout}</h2>
                                    <div className="space-y-4">
                                        <div className="about-name">‡∏ô‡∏≤‡∏¢‡∏Å‡∏£‡∏ì‡πå‡∏°‡∏¥‡∏©‡∏ê‡πå ‡∏≠‡∏¥‡∏ô‡∏î‡∏≤</div>
                                        <div className="about-name">‡∏ô‡∏≤‡∏¢‡∏ô‡∏û‡∏Å‡∏¥‡∏à ‡∏™‡∏∏‡∏£‡∏¥‡∏ô‡∏ó‡∏£‡πå‡∏ï‡πä‡∏∞</div>
                                        <div className="about-name">‡∏ô‡∏≤‡∏¢‡∏ß‡∏∏‡∏í‡∏¥‡∏†‡∏±‡∏ó‡∏£ ‡∏à‡πà‡∏≤‡∏´‡∏¢‡πà‡∏≠‡∏á</div>
                                        <div className="about-name">‡∏ô‡∏≤‡∏¢‡∏™‡∏∏‡∏£‡∏¥‡∏¢‡∏∞‡∏ó‡∏¥‡∏ï‡∏¢‡πå ‡∏™‡∏∏‡∏£‡∏¥‡∏¢‡∏∞‡∏ß‡∏á‡∏Ñ‡πå</div>
                                        <div className="about-name">‡∏ô‡∏≤‡∏¢‡∏à‡∏ï‡∏∏‡∏£‡∏á‡∏Ñ‡πå ‡∏Å‡∏¥‡∏à‡πÇ‡∏ä‡∏Ñ‡∏õ‡∏£‡∏∞‡πÄ‡∏™‡∏£‡∏¥‡∏ê</div>
                                    </div>
                                    <button onClick={() => setView('home')} className="btn-enter mt-10">{t.back}</button>
                                </div>
                            </div>
                        )}

                        {view === 'home' && (
                            <div className="flex-1 flex items-center justify-center p-6">
                                <div className="kahoot-card">
                                    <h2 className="text-2xl font-black mb-8 text-[#333]">GET STARTED</h2>
                                    <input className="kahoot-input mb-4" placeholder={t.nickname} value={username} onChange={e => setUsername(e.target.value)} />
                                    <button onClick={startHost} className="btn-enter mb-6">{t.hostBtn}</button>
                                    <div className="mb-6 opacity-20 font-black">- OR -</div>
                                    <input className="kahoot-input mb-4" placeholder="GAME PIN" value={roomCode} maxLength={4} onChange={e => setRoomCode(e.target.value.replace(/[^0-9]/g, ''))} />
                                    <button onClick={joinRoom} disabled={roomCode.length < 4} className="btn-enter !bg-[#333] hover:!bg-black disabled:opacity-20">ENTER</button>
                                </div>
                            </div>
                        )}

                        {view === 'waiting' && (
                            <div className="flex-1 flex flex-col items-center justify-center p-6">
                                <div className="max-w-4xl w-full flex flex-col items-center">
                                    <div className="bg-white text-[#333] p-10 rounded-sm shadow-xl text-center w-full max-w-md mb-12">
                                        <div className="text-xs font-black opacity-40 mb-2 uppercase">GAME PIN:</div>
                                        <div className="text-7xl font-black">{pin || roomCode}</div>
                                    </div>
                                    <div className="grid grid-cols-2 md:grid-cols-4 gap-4 w-full">
                                        {players.map((p, i) => (
                                            <div key={i} className="bg-white/10 p-4 font-black text-xl text-center border-b-4 border-black/20">
                                                {p.name}
                                            </div>
                                        ))}
                                    </div>
                                    {isHost && players.length > 1 && (
                                        <button onClick={startGame} className="btn-enter max-w-sm !bg-white !text-[#46178f] mt-12 text-2xl py-6">START</button>
                                    )}
                                    {!isHost && <div className="mt-12 text-2xl font-black animate-pulse">{t.waiting}</div>}
                                </div>
                            </div>
                        )}

                        {view === 'playing' && (
                            <div className="flex-1 flex flex-col p-6 max-w-7xl mx-auto w-full main-content">
                                <div className="chalkboard mb-10">
                                    {currentQ.q}
                                </div>

                                <div className="flex justify-between items-center mb-8 bg-black/10 p-4 font-black">
                                    <div>{t.question} {currentQ.n} / 10</div>
                                    <div className={timer < 6 ? 'text-red-500' : ''}>TIME: {timer}</div>
                                    <div>{answersCount.r} / {answersCount.t} {t.answered}</div>
                                </div>

                                <div className="flex-1 grid grid-cols-1 sm:grid-cols-2 gap-4">
                                    {['kb-red', 'kb-blue', 'kb-yellow', 'kb-green'].map((c, i) => (
                                        <button key={i} onClick={() => submit(currentQ.opts[i])} disabled={hasAnswered} className={`grid-button ${c} ${hasAnswered ? 'opacity-20' : ''}`}>
                                            <Shape type={['tri', 'dia', 'cir', 'squ'][i]} />
                                            <span className="truncate">{currentQ.opts[i]}</span>
                                        </button>
                                    ))}
                                </div>
                            </div>
                        )}

                        {view === 'leaderboard' && (
                            <div className="flex-1 flex flex-col items-center justify-center p-6">
                                <h2 className="text-6xl font-black mb-12 uppercase">{t.scoreboard}</h2>
                                <div className="max-w-md w-full space-y-2">
                                    {players.sort((a, b) => b.score - a.score).map((p, i) => (
                                        <div key={i} className="bg-white text-[#333] p-6 flex justify-between items-center font-black text-2xl shadow-lg">
                                            <span>{p.name} {p.id === 'me' && '‚ö°'}</span>
                                            <span>{p.score}</span>
                                        </div>
                                    ))}
                                </div>
                            </div>
                        )}

                        {view === 'gameover' && (
                            <div className="flex-1 flex flex-col items-center justify-center p-6 text-center">
                                <h1 className="text-8xl font-black mb-16 uppercase">{t.champion}</h1>
                                <div className="kahoot-card mb-12">
                                    {winners.slice(0, 3).map((w, i) => (
                                        <div key={i} className="text-3xl font-black mb-4 border-b pb-2 text-[#46178f]">
                                            {i + 1}. {w.name} - {w.score} pts
                                        </div>
                                    ))}
                                </div>
                                <button onClick={() => window.location.reload()} className="btn-enter max-w-sm">{t.back}</button>
                            </div>
                        )}
                    </div>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>

</html>