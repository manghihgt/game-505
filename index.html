<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>MATH CHALLENGE | Classroom Edition</title>
    <!-- Dependencies -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/peerjs@1.5.2/dist/peerjs.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.9.2/dist/confetti.browser.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=Kanit:wght@300;400;600&display=swap"
        rel="stylesheet">
    <style>
        :root {
            --kahoot-purple: #46178f;
            --kahoot-red: #e21b3c;
            --kahoot-blue: #1368ce;
            --kahoot-yellow: #d89e00;
            --kahoot-green: #26890c;
            --mac-glass: rgba(255, 255, 255, 0.2);
        }

        body {
            font-family: 'Inter', 'Kanit', sans-serif;
            margin: 0;
            padding: 0;
            overflow: hidden;
            height: 100vh;
            width: 100vw;
            background: #000;
        }

        .classroom-bg {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            background: linear-gradient(rgba(70, 23, 143, 0.6), rgba(70, 23, 143, 0.6)), url('https://images.unsplash.com/photo-1509062522246-3755977927d7?q=80&w=2132&auto=format&fit=crop');
            background-size: cover;
            background-position: center;
        }

        .mac-menubar {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 30px;
            background: rgba(0, 0, 0, 0.4);
            backdrop-filter: blur(20px);
            display: flex;
            align-items: center;
            padding: 0 15px;
            color: #fff;
            font-size: 14px;
            z-index: 1000;
        }

        .mac-window {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(30px);
            border-radius: 12px;
            box-shadow: 0 30px 60px rgba(0, 0, 0, 0.4);
            overflow: hidden;
            width: 95%;
            max-width: 1200px;
            height: 80vh;
            margin: auto;
            position: relative;
        }

        .window-titlebar {
            height: 40px;
            display: flex;
            align-items: center;
            padding: 0 15px;
            background: #f1f1f1;
            border-bottom: 1px solid #ddd;
        }

        .traffic-lights {
            display: flex;
            gap: 8px;
        }

        .dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
        }

        .dot-red {
            background: #FF5F56;
        }

        .dot-yellow {
            background: #FFBD2E;
        }

        .dot-green {
            background: #27C93F;
        }

        .window-content {
            height: calc(100% - 40px);
            overflow-y: auto;
            position: relative;
        }

        .app-dock {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(25px);
            padding: 10px 20px;
            border-radius: 20px;
            display: flex;
            gap: 20px;
            z-index: 1001;
            border: 1px solid rgba(255, 255, 255, 0.3);
        }

        .dock-item {
            cursor: pointer;
            transition: transform 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            display: flex;
            flex-direction: column;
            align-items: center;
            color: white;
            font-size: 10px;
            font-weight: bold;
        }

        .dock-item:hover {
            transform: scale(1.3) translateY(-10px);
        }

        .dock-icon {
            width: 45px;
            height: 45px;
            background: white;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            margin-bottom: 4px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
        }

        .kahoot-header {
            background: white;
            padding: 20px 40px;
            border-bottom-left-radius: 40px;
            border-bottom-right-radius: 40px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            position: absolute;
            top: 0;
            left: 50%;
            transform: translateX(-50%);
            z-index: 20;
            display: flex;
            gap: 40px;
            align-items: center;
        }

        .pin-box {
            text-align: center;
        }

        .pin-label {
            font-weight: 800;
            color: #666;
            font-size: 14px;
            text-transform: uppercase;
        }

        .pin-value {
            font-size: 48px;
            font-weight: 900;
            letter-spacing: 4px;
            color: #333;
        }

        .player-block {
            background: var(--kahoot-purple);
            color: white;
            padding: 15px 30px;
            border-radius: 4px;
            font-size: 24px;
            font-weight: 900;
            box-shadow: 0 4px 0 rgba(0, 0, 0, 0.2);
            animation: popIn 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        @keyframes popIn {
            0% {
                scale: 0;
            }

            100% {
                scale: 1;
            }
        }

        .quiz-option {
            height: 120px;
            display: flex;
            align-items: center;
            padding: 0 30px;
            color: white;
            font-size: 32px;
            font-weight: 900;
            border-radius: 6px;
            transition: opacity 0.2s;
            box-shadow: 0 4px 0 rgba(0, 0, 0, 0.2);
        }

        .quiz-option:hover {
            opacity: 0.9;
        }

        .quiz-option:active {
            transform: translateY(4px);
            box-shadow: none;
        }

        .chalkboard {
            background: #2d4f3b;
            border: 15px solid #8b4513;
            border-radius: 10px;
            padding: 40px;
            color: white;
            font-family: "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol";
            box-shadow: inset 0 0 50px rgba(0, 0, 0, 0.5);
        }

        #qrcode canvas {
            width: 100px !important;
            height: 100px !important;
        }

        .about-card {
            background: white;
            border-radius: 15px;
            padding: 30px;
            margin: 10px;
            width: 100%;
            max-width: 400px;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
        }
    </style>
</head>

<body>
    <div class="classroom-bg"></div>

    <div class="mac-menubar">
        <div class="flex-1 font-black tracking-tighter">MATH CHALLENGE</div>
        <div id="time-display" class="font-bold">00:00</div>
    </div>

    <div id="root"></div>

    <div class="app-dock">
        <div class="dock-item" onclick="window.nav('home')">
            <div class="dock-icon" style="background: linear-gradient(#FF5F56, #FFBD2E)">üè†</div>
            <span>HOME</span>
        </div>
        <div class="dock-item" onclick="window.nav('about')">
            <div class="dock-icon" style="background: linear-gradient(#5F56FF, #27C93F)">üë•</div>
            <span>ABOUT</span>
        </div>
        <div class="dock-item" onclick="window.nav('settings')">
            <div class="dock-icon" style="background: linear-gradient(#333, #666)">‚öôÔ∏è</div>
            <span>SETTINGS</span>
        </div>
    </div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        const translations = {
            TH: {
                home: "‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å",
                about: "‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Å‡∏±‡∏ö‡πÄ‡∏£‡∏≤",
                settings: "‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤",
                host: "‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏Å‡∏°",
                join: "‡πÄ‡∏Ç‡πâ‡∏≤‡πÄ‡∏•‡πà‡∏ô‡πÄ‡∏Å‡∏°",
                pinPlaceholder: "‡πÉ‡∏™‡πà‡∏£‡∏´‡∏±‡∏™ PIN 4 ‡∏´‡∏•‡∏±‡∏Å",
                enter: "‡∏ï‡∏Å‡∏•‡∏á",
                nickname: "‡πÉ‡∏™‡πà‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏•‡πà‡∏ô‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì",
                waiting: "‡∏£‡∏≠‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡∏Ñ‡∏ô‡∏≠‡∏∑‡πà‡∏ô...",
                start: "‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏Å‡∏°‡πÄ‡∏•‡∏¢!",
                team: "‡∏ó‡∏µ‡∏°‡∏á‡∏≤‡∏ô‡∏ú‡∏π‡πâ‡∏û‡∏±‡∏í‡∏ô‡∏≤",
                lang: "‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏†‡∏≤‡∏©‡∏≤",
                music: "‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡πÄ‡∏û‡∏•‡∏á",
                question: "‡∏Ç‡πâ‡∏≠‡∏ó‡∏µ‡πà",
                correct: "‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á!",
                wrong: "‡πÄ‡∏™‡∏µ‡∏¢‡πÉ‡∏à‡∏î‡πâ‡∏ß‡∏¢...",
                results: "‡∏Å‡∏£‡∏∞‡∏î‡∏≤‡∏ô‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô"
            },
            EN: {
                home: "Home",
                about: "About Us",
                settings: "Settings",
                host: "Host Game",
                join: "Join Game",
                pinPlaceholder: "Enter 4-digit PIN",
                enter: "Enter",
                nickname: "Enter your nickname",
                waiting: "Waiting for players...",
                start: "Start Game!",
                team: "Development Team",
                lang: "Language",
                music: "Music",
                question: "Question",
                correct: "Correct!",
                wrong: "Too bad...",
                results: "Leaderboard"
            }
        };

        const generateQuestion = () => {
            const types = ['+', '-', '*', '/'];
            const type = types[Math.floor(Math.random() * types.length)];
            let a, b, ans;
            if (type === '+') { a = Math.floor(Math.random() * 50); b = Math.floor(Math.random() * 50); ans = a + b; }
            else if (type === '-') { a = Math.floor(Math.random() * 50) + 50; b = Math.floor(Math.random() * 50); ans = a - b; }
            else if (type === '*') { a = Math.floor(Math.random() * 12); b = Math.floor(Math.random() * 12); ans = a * b; }
            else { b = Math.floor(Math.random() * 10) + 1; ans = Math.floor(Math.random() * 10) + 1; a = b * ans; }

            const options = new Set([ans]);
            while (options.size < 4) {
                const off = Math.floor(Math.random() * 10) + 1;
                options.add(ans + (Math.random() > 0.5 ? off : -off));
            }
            return { q: `${a} ${type} ${b} = ?`, options: Array.from(options).sort(() => Math.random() - 0.5), ans };
        };

        function App() {
            const [view, setView] = useState('home');
            const [lang, setLang] = useState('TH');
            const [music, setMusic] = useState(true);
            const [username, setUsername] = useState('');
            const [roomCode, setRoomCode] = useState('');
            const [pin, setPin] = useState('');
            const [isHost, setIsHost] = useState(false);
            const [players, setPlayers] = useState([]);
            const [myPeer, setMyPeer] = useState(null);
            const [currentQ, setCurrentQ] = useState(null);
            const [gameState, setGameState] = useState('lobby'); // lobby, playing, result
            const [score, setScore] = useState(0);
            const [answered, setAnswered] = useState(false);
            const [timer, setTimer] = useState(30);

            const conns = useRef([]);
            const hostConn = useRef(null);
            const t = translations[lang];

            window.nav = (v) => setView(v);

            useEffect(() => {
                const interval = setInterval(() => {
                    const now = new Date();
                    document.getElementById('time-display').innerText = now.getHours().toString().padStart(2, '0') + ':' + now.getMinutes().toString().padStart(2, '0');
                }, 1000);
                return () => clearInterval(interval);
            }, []);

            const cleanup = () => {
                if (myPeer) myPeer.destroy();
                conns.current.forEach(c => c.close());
                conns.current = [];
            };

            const startHost = () => {
                if (!username) return alert(t.nickname);
                cleanup();
                const randomPIN = Math.floor(1000 + Math.random() * 8999).toString();
                const p = new Peer(`mc-${randomPIN}`);
                p.on('open', id => {
                    setPin(id.replace('mc-', '')); setIsHost(true); setMyPeer(p);
                    setPlayers([{ id: 'me', name: username, score: 0 }]);
                    setView('lobby');
                });
                p.on('connection', c => {
                    c.on('data', d => {
                        if (d.type === 'join') {
                            setPlayers(prev => {
                                const exists = prev.find(p => p.id === c.peer);
                                if (exists) return prev;
                                const newList = [...prev, { id: c.peer, name: d.name, score: 0 }];
                                conns.current.forEach(cnx => cnx.send({ type: 'plist', players: newList }));
                                return newList;
                            });
                        }
                        if (d.type === 'ans') {
                            // Host logic to handle scores
                        }
                    });
                    c.on('open', () => conns.current.push(c));
                });
            };

            const joinGame = () => {
                if (!username || !roomCode) return alert('Name & PIN required!');
                cleanup();
                const p = new Peer();
                p.on('open', () => {
                    setMyPeer(p);
                    const c = p.connect(`mc-${roomCode}`);
                    hostConn.current = c;
                    c.on('open', () => {
                        c.send({ type: 'join', name: username });
                        setView('lobby');
                    });
                    c.on('data', d => {
                        if (d.type === 'plist') setPlayers(d.players);
                        if (d.type === 'start') { setGameState('playing'); setView('game'); }
                    });
                });
            };

            const hostStart = () => {
                conns.current.forEach(c => c.send({ type: 'start' }));
                setView('game');
                setGameState('playing');
                nextQuestion();
            };

            const nextQuestion = () => {
                const q = generateQuestion();
                setCurrentQ(q);
                setAnswered(false);
                setTimer(30);
            };

            const submitAns = (val) => {
                setAnswered(true);
                if (val === currentQ.ans) {
                    setScore(s => s + 100);
                    confetti();
                }
            };

            const QRCodeBox = ({ value }) => {
                const qrRef = useRef();
                useEffect(() => {
                    if (qrRef.current && value) {
                        qrRef.current.innerHTML = "";
                        new QRCode(qrRef.current, { text: value, width: 100, height: 100 });
                    }
                }, [value]);
                return <div ref={qrRef} className="bg-white p-2 rounded shadow"></div>;
            };

            return (
                <div className="flex items-center justify-center h-screen w-full pt-10 pb-32">
                    <div className="mac-window">
                        <div className="window-titlebar">
                            <div className="traffic-lights">
                                <div className="dot dot-red"></div>
                                <div className="dot dot-yellow"></div>
                                <div className="dot dot-green"></div>
                            </div>
                            <div className="flex-1 text-center font-bold text-gray-500 uppercase tracking-widest text-[10px]">Math Challenge</div>
                        </div>

                        <div className="window-content">
                            {view === 'home' && (
                                <div className="flex flex-col items-center justify-center h-full p-10 bg-[#46178f] text-white">
                                    <h1 className="text-6xl font-black mb-12">Math Challenge</h1>
                                    <div className="w-full max-w-sm space-y-4">
                                        <input className="w-full p-4 text-2xl text-center rounded text-black font-bold" placeholder={t.pinPlaceholder} value={roomCode} onChange={e => setRoomCode(e.target.value)} />
                                        <input className="w-full p-4 text-xl text-center rounded text-black font-bold" placeholder={t.nickname} value={username} onChange={e => setUsername(e.target.value)} />
                                        <div className="grid grid-cols-2 gap-4">
                                            <button onClick={joinGame} className="bg-black text-white p-4 rounded font-black text-xl active:scale-95 transition">{t.join}</button>
                                            <button onClick={startHost} className="bg-white text-black p-4 rounded font-black text-xl active:scale-95 transition">{t.host}</button>
                                        </div>
                                    </div>
                                </div>
                            )}

                            {view === 'lobby' && (
                                <div className="h-full flex flex-col items-center justify-center p-10">
                                    <div className="kahoot-header">
                                        <div className="text-xl font-bold text-purple-800">JOIN AT <br /> YOUR-URL.COM</div>
                                        <div className="pin-box">
                                            <div className="pin-label">Game PIN:</div>
                                            <div className="pin-value">{pin || roomCode}</div>
                                        </div>
                                        <QRCodeBox value={`${window.location.origin}?pin=${pin || roomCode}`} />
                                    </div>
                                    <div className="flex-1 w-full flex flex-wrap gap-4 items-center justify-center mt-32">
                                        {players.map((p, i) => (
                                            <div key={i} className="player-block flex items-center gap-4">
                                                <span>üëæ</span> {p.name}
                                            </div>
                                        ))}
                                    </div>
                                    <div className="w-full p-8 flex justify-between items-center">
                                        <div className="text-2xl font-black bg-black/20 text-white px-6 py-2 rounded-full">üë• {players.length}</div>
                                        {isHost && players.length > 0 && (
                                            <button onClick={hostStart} className="bg-green-500 text-white px-12 py-4 rounded font-black text-3xl shadow-xl hover:bg-green-600 active:scale-95 transition">START</button>
                                        )}
                                    </div>
                                </div>
                            )}

                            {view === 'game' && currentQ && (
                                <div className="h-full flex flex-col p-10">
                                    <div className="flex items-center gap-8 mb-8">
                                        <div className="w-20 h-20 rounded-full bg-purple-700 flex items-center justify-center text-white text-3xl font-black">{timer}</div>
                                        <div className="flex-1 bg-white p-6 rounded shadow-xl text-center text-4xl font-black">{currentQ.q}</div>
                                        <div className="w-20 h-20 rounded-full bg-blue-700 flex items-center justify-center text-white text-3xl font-black">0</div>
                                    </div>

                                    <div className="flex-1 flex items-center justify-center mb-10">
                                        <div className="chalkboard w-full max-w-2xl text-center">
                                            <img src="https://images.unsplash.com/photo-1635070041078-e363dbe005cb?q=80&w=2070&auto=format&fit=crop" className="mx-auto h-64 rounded shadow-2xl" />
                                        </div>
                                    </div>

                                    <div className="grid grid-cols-2 gap-4">
                                        {['red', 'blue', 'yellow', 'green'].map((color, i) => (
                                            <button
                                                key={i}
                                                disabled={answered}
                                                onClick={() => submitAns(currentQ.options[i])}
                                                className="quiz-option"
                                                style={{ backgroundColor: `var(--kahoot-${color})` }}>
                                                <span className="text-4xl mr-6">{['‚ñ≤', '‚óÜ', '‚óè', '‚ñ†'][i]}</span>
                                                {currentQ.options[i]}
                                            </button>
                                        ))}
                                    </div>
                                </div>
                            )}

                            {view === 'about' && (
                                <div className="h-full flex flex-col items-center justify-center p-10 bg-purple-50">
                                    <h1 className="text-4xl font-black mb-10 text-purple-900">{t.team}</h1>
                                    <div className="grid grid-cols-1 md:grid-cols-2 gap-6 w-full max-w-4xl">
                                        {[
                                            "‡∏ô‡∏≤‡∏¢‡∏Å‡∏£‡∏°‡∏¥‡∏©‡∏ê‡πå ‡∏≠‡∏¥‡∏ô‡∏î‡∏≤",
                                            "‡∏ô‡∏≤‡∏¢‡∏ô‡∏û‡∏Å‡∏¥‡∏à ‡∏™‡∏∏‡∏£‡∏¥‡∏ô‡∏ó‡∏£‡πå‡∏ï‡πä‡∏∞",
                                            "‡∏ô‡∏≤‡∏¢‡∏ß‡∏∏‡∏í‡∏¥‡∏†‡∏±‡∏ó‡∏£ ‡∏à‡πà‡∏≤‡∏´‡∏¢‡πà‡∏≠‡∏á",
                                            "‡∏ô‡∏≤‡∏¢‡∏™‡∏∏‡∏£‡∏¥‡∏¢‡∏∞‡∏ó‡∏¥‡∏ï‡∏¢‡πå ‡∏™‡∏∏‡∏£‡∏¥‡∏¢‡∏∞‡∏ß‡∏á‡∏Ñ‡πå",
                                            "‡∏ô‡∏≤‡∏¢‡∏à‡∏ï‡∏∏‡∏£‡∏á‡∏Ñ‡πå ‡∏Å‡∏¥‡∏à‡πÇ‡∏ä‡∏Ñ‡∏õ‡∏£‡∏∞‡πÄ‡∏™‡∏£‡∏¥‡∏ê"
                                        ].map((name, i) => (
                                            <div key={i} className="bg-white p-6 rounded-xl shadow-lg border-l-8 border-purple-600 flex items-center gap-4">
                                                <div className="text-3xl">üßë‚Äçüéì</div>
                                                <div className="text-xl font-bold">{name}</div>
                                            </div>
                                        ))}
                                    </div>
                                </div>
                            )}

                            {view === 'settings' && (
                                <div className="h-full flex flex-col items-center justify-center p-10">
                                    <h1 className="text-4xl font-black mb-12 text-purple-900">{t.settings}</h1>
                                    <div className="space-y-8 w-full max-w-md">
                                        <div className="flex justify-between items-center bg-white p-6 rounded-2xl shadow-xl">
                                            <span className="text-xl font-bold">üåç {t.lang}</span>
                                            <button onClick={() => setLang(l => l === 'TH' ? 'EN' : 'TH')} className="bg-purple-600 text-white px-6 py-2 rounded-full font-bold">{lang}</button>
                                        </div>
                                        <div className="flex justify-between items-center bg-white p-6 rounded-2xl shadow-xl">
                                            <span className="text-xl font-bold">üéµ {t.music}</span>
                                            <button onClick={() => setMusic(!music)} className={`${music ? 'bg-green-500' : 'bg-red-500'} text-white px-6 py-2 rounded-full font-bold`}>{music ? 'ON' : 'OFF'}</button>
                                        </div>
                                    </div>
                                </div>
                            )}
                        </div>
                    </div>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>

</html>